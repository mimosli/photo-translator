<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Photo Translator</title>

  <!-- (STYLE SECTION UNCHANGED EXCEPT ADDITION BELOW) -->
  <style>
    /* … YOUR EXISTING CSS … */

    /* --- Processing indicator (NEW) --- */
    .processing {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--muted);
      margin-top: 6px;
    }
    .spinner {
      width: 16px;
      height: 16px;
      border: 3px solid rgba(255,255,255,.2);
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin .8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .hidden { display: none; }
  </style>
</head>

<body>
  <!-- (BODY CONTENT UNCHANGED UNTIL STATUS AREA) -->

  <!-- STATUS -->
  <div id="status" role="status" aria-live="polite"></div>

  <!-- PROCESSING INDICATOR (NEW) -->
  <div id="processing" class="processing hidden">
    <div class="spinner"></div>
    <span id="processingText">Processing…</span>
  </div>

  <!-- (REST OF HTML UNCHANGED) -->

  <script>
    /* --- EXISTING SCRIPT ABOVE UNCHANGED --- */

    const processingEl   = document.getElementById("processing");
    const processingText = document.getElementById("processingText");

    function showProcessing(text){
      processingText.textContent = text || "Processing…";
      processingEl.classList.remove("hidden");
    }
    function hideProcessing(){
      processingEl.classList.add("hidden");
    }

    // ---- MODIFY EXISTING HANDLERS ONLY ----

    uploadBtn.addEventListener("click", async () => {
      if(!processedBlob) return;
      uploadBtn.disabled = true;
      translateBtn.disabled = true;
      clearBtn.disabled = true;

      showProcessing("Uploading image…");
      statusNeutral("Saving image…");

      try{
        const form = new FormData();
        form.append(CONFIG.FIELD_NAME, processedBlob, processedName || "upload.jpg");
        const res  = await fetch(CONFIG.UPLOAD_URL, { method:"POST", body: form });
        if(!res.ok) throw new Error("Upload failed.");
        statusOk("Saved ✅");
      }catch(err){
        statusErr(err.message);
      }finally{
        hideProcessing();
        uploadBtn.disabled = false;
        translateBtn.disabled = false;
        clearBtn.disabled = false;
      }
    });

    translateBtn.addEventListener("click", async () => {
      if(!processedBlob) return;

      uploadBtn.disabled = true;
      translateBtn.disabled = true;
      clearBtn.disabled = true;

      translateBtn.textContent = "Processing…";
      showProcessing("Running OCR & translation…");
      setProgress(3);

      try{
        const form = new FormData();
        form.append("image", processedBlob, processedName || "photo.jpg");
        const res  = await fetch(CONFIG.TRANSLATE_URL, { method:"POST", body: form });
        const body = await res.text();
        if(!res.ok) throw new Error("Translation failed.");
        document.open(); document.write(body); document.close();
      }catch(err){
        statusErr(err.message);
        hideProcessing();
        translateBtn.textContent = "Translate ✨";
        uploadBtn.disabled = false;
        translateBtn.disabled = false;
        clearBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
